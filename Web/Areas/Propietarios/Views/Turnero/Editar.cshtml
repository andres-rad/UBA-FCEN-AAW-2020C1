@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@using Web.Areas.Propietarios.Models
@using Aplicacion.UseCases.Propietario
@model EditarTurneroVM
@{ 
    ViewData["Area"] = "Propietarios";
}

<style>
    .preview-images-zone
    {
        width: 100%;
        border: 1px solid #ddd;
        min-height: 180px;
        /* display: flex; */
        padding: 5px 5px 0px 5px;
        position: relative;
        overflow:auto;
    }
    .preview-images-zone > .preview-image:first-child
    {
        height: 185px;
        width: 185px;
        position: relative;
        margin-right: 5px;
    }
    .preview-images-zone > .preview-image
    {
        height: 90px;
        width: 90px;
        position: relative;
        margin-right: 5px;
        float: left;
        margin-bottom: 5px;
    }
    .preview-images-zone > .preview-image > .image-zone
    {
        width: 100%;
        height: 100%;
    }
    .preview-images-zone > .preview-image > .image-zone > img
    {
        width: 100%;
        height: 100%;
    }
    .preview-images-zone > .preview-image > .tools-edit-image
    {
        position: absolute;
        z-index: 100;
        color: #fff;
        bottom: 0;
        width: 100%;
        text-align: center;
        margin-bottom: 10px;
        display: none;
    }
    .preview-images-zone > .preview-image > .image-cancel
    {
        font-size: 18px;
        position: absolute;
        top: 0;
        right: 0;
        font-weight: bold;
        margin-right: 10px;
        cursor: pointer;
        display: none;
        z-index: 100;
    }
    .preview-image:hover > .image-zone
    {
        cursor: move;
        opacity: .5;
    }
    .preview-image:hover > .tools-edit-image,
    .preview-image:hover > .image-cancel
    {
        display: block;
    }
    .ui-sortable-helper
    {
        width: 90px !important;
        height: 90px !important;
    }
</style>

<h1>Editar Turnero</h1>

<form asp-action="Editar" method="post" name="editarTurneroForm" enctype="multipart/form-data">
    <div class="form-group">
        <label for="conceptoInput">Descripción</label>
        <input type="text"
               class="form-control"
               id="conceptoInput"
               aria-describedby="concepto"
               placeholder="Descripción del servicio"
               name="concepto"
               asp-for="Concepto">
    </div>
    <h4> Dirección </h4>
    <hr />
    <div class="form-row">
        <div class="form-group col-md-6">
            <label for="inputCiudad">Ciudad</label>
            <input type="text"
                   class="form-control"
                   id="inputCiudad"
                   name="ciudad"
                   asp-for="Ciudad" />
        </div>
        <div class="form-group col-md-4">
            <label for="inputCalle">Calle</label>
            <input type="text"
                   id="inputCalle"
                   class="form-control"
                   name="calle"
                   asp-for="Calle" />
        </div>
        <div class="form-group col-md-2">
            <label for="inputNumero">Altura</label>
            <input type="number"
                   class="form-control"
                   id="inputNumero"
                   min="1"
                   name="numero"
                   asp-for="Numero">
        </div>
    </div>
    <div id="buscarTurneroMap" style="height:50vh"></div>
    <div class="form-row">
        <div class="form-group col-md-4">
            <input type="text"
                   readonly
                   placeholder="Latitud"
                   class="form-control"
                   id="inputLatitud"
                   name="latitud"
                   asp-for="Latitud"
                   required>
        </div>
        <div class="form-group col-md-4">
            <input type="text"
                   readonly
                   placeholder="Longitud"
                   class="form-control"
                   id="inputLongitud"
                   name="longitud"
                   asp-for="Longitud"
                   required>
        </div>
    </div>
    <div class="form-group">
        <label for="inputCapacidad"> Capacidad máxima </label>
        <input type="number"
               class="form-control"
               id="inputCapacidad"
               min="1"
               placeholder="Tamaño de la cola"
               name="CantidadMaxima"
               asp-for="CantidadMaxima" />
    </div>

    <div class="form-group">
        <fieldset>
            <a href="javascript:void(0)" onclick="$('#pro-image').click()">Subir imagen</a>
            <input type="file" asp-for="Imagenes" id="pro-image" name="pro-image" style="display: none;" class="form-control" multiple>
        </fieldset>
        <div class="preview-images-zone">

        </div>
    </div>

    <div class="form-group">
        <label for="inputIdTurnero"></label>
        <input type="hidden"
               class="form-control"
               id="inputIdTurnero"
               min="0"
               name="IdTurnero"
               asp-for="IdTurnero" />
    </div>

    <button type="submit" class="btn btn-primary">Submit</button>


    <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script type="text/javascript">
            $(document).ready(function()
            {
            document.getElementById('pro-image').addEventListener('change', readImage, false);
            
            //$( ".preview-images-zone" ).sortable();
            
            $(document).on('click', '.image-cancel', function()
            {
                let no = $(this).data('no');
                $(".preview-image.preview-show-"+no).remove();
            });
        });

        var num = 4;
        function readImage() {
            if (window.File && window.FileList && window.FileReader)
            {
                var files = event.target.files; //FileList object
                var output = $(".preview-images-zone");

                for (let i = 0; i < files.length; i++)
                {
                    var file = files[i];
                    if (!file.type.match('image')) continue;
                    
                    var picReader = new FileReader();
                    
                    picReader.addEventListener('load', function (event)
                    {
                        var picFile = event.target;
                        var html =  '<div class="preview-image preview-show-' + num + '">' +
                                    '<div class="image-cancel" data-no="' + num + '">x</div>' +
                                    '<div class="image-zone"><img id="pro-img-' + num + '" src="' + picFile.result + '"></div>' +
                                    '</div>';

                        output.append(html);
                        num = num + 1;
                    });

                    picReader.readAsDataURL(file);
                }
                $("#pro-image").val('');
            } else {
                console.log('Browser not support');
            }
        }
    </script>


    <script src="https://openlayers.org/api/OpenLayers.js"></script>
    <script>
        /////////////////////////////////////////////////////////
        // FACTORIZAR
        var zoom = 12;
        var latIni = -34.6302673;
        var lonIni = -58.4356537;
        var fromProjection = new OpenLayers.Projection("EPSG:4326");   // Transform from WGS 1984
        var toProjection = new OpenLayers.Projection("EPSG:900913"); // to Spherical Mercator Projection
        var positionIni = new OpenLayers.LonLat(lonIni, latIni).transform(fromProjection, toProjection);


        map = new OpenLayers.Map({
            div: "buscarTurneroMap",
            theme: null,
            projection: new OpenLayers.Projection("EPSG:900913"),
            numZoomLevels: 18,
            controls: [
                new OpenLayers.Control.TouchNavigation({
                    dragPanOptions: {
                        enableKinetic: true
                    }
                }),
                new OpenLayers.Control.Zoom()
            ],
            layers: [
                new OpenLayers.Layer.OSM("OpenStreetMap", null, {
                    transitionEffect: 'resize'
                }),
                new OpenLayers.Layer.Markers("Markers")
            ]
        });
        map.setCenter(positionIni, zoom);


        map.events.register('click', map, handleClick);
        map.events.register('touchstart', map, handleClick);

        function handleClick(e) {
            var lonlat = map.getLonLatFromViewPortPx(e.xy);
            addMarker(lonlat);
            lonlat = new OpenLayers.LonLat(lonlat.lon, lonlat.lat).transform(toProjection, fromProjection);
            $("#inputLatitud").val(lonlat.lat);
            $("#inputLongitud").val(lonlat.lon);
        }

        var size = new OpenLayers.Size(21, 25);
        var offset = new OpenLayers.Pixel(-(size.w / 2), -size.h);
        var icon = new OpenLayers.Icon('https://www.flaticon.com/premium-icon/icons/svg/2776/2776000.svg', size, offset);


        function addMarker(position) {
            var markers = map.layers[1]
            markers.clearMarkers();
            markers.addMarker(new OpenLayers.Marker(position, icon));
        }
    </script>
</form>